<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neo Survivors Idle</title>
  <!-- Import map for bare @pixi/* specifiers used by pixi-filters. PIXI.js 7.x
       bundles all modules together, so all mappings point to the same main bundle. -->
  <script type="importmap">
    {
      "imports": {
        "@pixi/core": "https://cdn.jsdelivr.net/npm/pixi.js@7.4.2/dist/pixi.min.mjs",
        "@pixi/filter-blur": "https://cdn.jsdelivr.net/npm/pixi.js@7.4.2/dist/pixi.min.mjs",
        "@pixi/filter-alpha": "https://cdn.jsdelivr.net/npm/pixi.js@7.4.2/dist/pixi.min.mjs"
      }
    }
  </script>
  <link rel="stylesheet" href="./public/assets/styles/main.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Fredoka:wght@500;600;700&family=Nunito:wght@500;600&display=swap"
    rel="stylesheet"
  />
</head>
<body>
  <header class="topbar">
    <div class="topbar-left">
      <img src="./public/assets/logo.svg" alt="Neo Survivors Idle Logo" class="game-logo" />
      <div>
        <p class="eyebrow">Incremental x Survivors</p>
        <h1>Neo Survivors Idle</h1>
        <p class="lede">Un auto-battler infini, 100% client-side, qui tourne mÃªme quand tu fermes l'onglet.</p>
      </div>
    </div>
    <div class="cta">
      <button id="resetProgress" class="ghost">RÃ©initialiser la progression</button>
      <button id="toggleSound" class="ghost">ğŸ”Š Son ON</button>
      <button id="togglePerf" class="ghost">âš™ï¸ Mode perfo</button>
      <button id="pause" class="primary">â¸ Pause</button>
    </div>
  </header>

  <main class="layout">
    <section class="panel stats">
      <div class="stat-block">
        <h2>Ressources</h2>
        <div class="stat-row">
          <span><span class="icon">âš¡</span> Essence</span>
          <span id="essence">0</span>
        </div>
        <div class="stat-row">
          <span><span class="icon">âœ¦</span> Fragments</span>
          <span id="fragments">0</span>
        </div>
        <div class="stat-row muted">
          <span><span class="icon">â±</span> Gain passif</span>
          <span id="idleRate">0 /s</span>
        </div>
      </div>

      <div class="stat-block">
        <h2>Run en cours</h2>
        <div class="stat-row"><span><span class="icon">ğŸŒŠ</span> Vague</span><span id="wave">1</span></div>
        <div class="stat-row"><span><span class="icon">â¤ï¸</span> Vie</span><span id="hp">100</span></div>
        <div class="stat-row tooltip" id="damageRow"><span><span class="icon">ğŸ”¥</span> DÃ©gÃ¢ts</span><span id="dps">0</span></div>
        <div class="stat-row"><span><span class="icon">ğŸ¯</span> Critiques</span><span id="crit">0%</span></div>
        <div class="stat-row"><span><span class="icon">ğŸ§¿</span> Bouclier</span><span id="shield">0%</span></div>
        <div class="stat-row"><span><span class="icon">ğŸ§²</span> Collecte</span><span id="collect">0</span></div>
        <div class="stat-row muted"><span><span class="icon">ğŸŒ€</span> Spawn</span><span id="spawnRate">0/s</span></div>
      </div>

      <div class="stat-block collapsible collapsed">
        <h2>Performance</h2>
        <div class="stat-row"><span><span class="icon">ğŸï¸</span> FPS</span><span id="fpsValue">--</span></div>
        <button id="toggleFps" class="ghost small">ğŸ“ˆ Afficher le graph</button>
        <canvas id="fpsGraph" class="fps-chart" width="260" height="80"></canvas>
      </div>

      <div class="stat-block collapsible collapsed">
        <h2>Addons visuels</h2>
        <p class="muted">Filtres PIXI optionnels.</p>
        <div class="debug-grid">
          <button id="toggleGlowFx" class="ghost">âœ¨ Aura</button>
          <button id="toggleBloomFx" class="ghost">ğŸŒŸ Bloom</button>
          <button id="toggleGrainFx" class="ghost">ğŸï¸ Grain</button>
          <button id="toggleHudPulse" class="ghost">ğŸ’« Pulse</button>
        </div>
      </div>

      <div class="stat-block">
        <h2>Production passive</h2>
        <div id="generators" class="list"></div>
      </div>
    </section>

    <section class="arena-wrapper">
      <canvas id="webgl2" class="arena-layer" width="960" height="600"></canvas>
      <canvas id="arena" width="960" height="600"></canvas>
      <div class="overlay">
        <p>Le personnage se dÃ©place et tire automatiquement. Les ennemis arrivent par vagues sans fin. Achetez des amÃ©liorations pour accÃ©lÃ©rer l'inflation de dÃ©gÃ¢ts.</p>
        <p class="muted">SauvegardÃ© dans le navigateur : cookies/localStorage, aucun serveur requis.</p>
        <p class="status" id="statusMessage"></p>
      </div>
    </section>

    <section class="panel upgrades">
      <div class="stat-block assist">
        <h2>Aide rapide</h2>
        <ul id="quickHelpList" class="assist-list"></ul>
      </div>

      <div class="stat-block assist">
        <h2>Jalons</h2>
        <ul id="milestoneList" class="assist-list milestones"></ul>
      </div>

      <div class="stat-block collapsible">
        <h2>Arbre de talents</h2>
        <p class="muted">Synergies persistantes : dÃ©gÃ¢ts, cadence, Ã©conomie, dÃ©fense.</p>
        <div id="talents" class="talent-grid"></div>
        <div class="talent-actions">
          <p id="talentStatus" class="muted"></p>
          <button id="resetTalents" class="ghost danger">ğŸ”„ Reset (1200 âœ¦)</button>
        </div>
      </div>
      <div class="stat-block">
        <h2>AmÃ©liorations</h2>
        <div id="upgrades" class="list"></div>
      </div>
      <div class="stat-block">
        <h2>Prestige</h2>
        <p class="muted">RÃ©duit ta vague Ã  1 mais boost le passif.</p>
        <button id="softPrestige" class="secondary">âŸ³ Consolidation</button>
        <button id="restartRun" class="ghost">â†» Relancer</button>
      </div>

      <div class="stat-block collapsible collapsed">
        <h2>Comment jouer</h2>
        <ul class="guide">
          <li>Investis l'Essence (âš¡) dans la production passive, puis les Fragments (âœ¦) pour le combat.</li>
          <li>Les vagues montent sans fin : lance une Consolidation pour booster le passif et repartir.</li>
          <li>Chaque ennemi dÃ©truit lÃ¢che des Fragments que ta bille aspire automatiquement.</li>
          <li>Ton tir tourne constamment et peut infliger des coups critiques.</li>
          <li>Des Ã©lites surgissent : elles donnent plus mais frappent plus fort.</li>
          <li>Mode perfo : effets rÃ©duits pour plus de fluiditÃ©.</li>
        </ul>
      </div>

      <div class="stat-block collapsible collapsed debug">
        <h2>Debug</h2>
        <p class="muted">Boutons de test local.</p>
        <div class="debug-grid">
          <button id="debugGiveEssence" class="ghost">+1M âš¡</button>
          <button id="debugGiveFragments" class="ghost">+1M âœ¦</button>
          <button id="debugSkipWave" class="ghost">+10 vagues</button>
          <button id="debugNuke" class="ghost">â˜„ï¸ Clear</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>Made for fun Â· Pas de serveur Â· Tout reste dans tes cookies</p>
  </footer>

  <div class="version-container">
    <button id="docBtn" class="doc-btn" aria-label="Ouvrir la documentation">ğŸ“š</button>
    <div id="versionBadge" class="version-badge"></div>
  </div>
  <div id="assistBubbles" class="assist-bubbles"></div>

  <!-- Documentation dialog (works independently of main.js) -->
  <dialog id="docDialog" class="doc-dialog">
    <div class="doc-dialog-header">
      <h2>ğŸ“š Documentation</h2>
      <button class="doc-close-btn" aria-label="Fermer" onclick="document.getElementById('docDialog').close()">âœ•</button>
    </div>
    <div class="doc-tabs" id="docTabs">
      <button class="doc-tab active" data-tab="code"><span class="tab-icon">ğŸ“</span><span class="tab-label">Code</span></button>
      <button class="doc-tab" data-tab="wiki"><span class="tab-icon">ğŸ“–</span><span class="tab-label">Wiki</span></button>
      <button class="doc-tab" data-tab="changelog"><span class="tab-icon">ğŸ“‹</span><span class="tab-label">Versions</span></button>
      <button class="doc-tab" data-tab="roadmap"><span class="tab-icon">ğŸ—ºï¸</span><span class="tab-label">Roadmap</span></button>
    </div>
    <div class="doc-content" id="docContent"></div>
  </dialog>

  <script>
    // Documentation dialog - works independently of main game modules
    (function() {
      const VERSION = "v0.1.0";
      const dialog = document.getElementById('docDialog');
      const docBtn = document.getElementById('docBtn');
      const tabs = document.getElementById('docTabs');
      const content = document.getElementById('docContent');
      const versionBadge = document.getElementById('versionBadge');
      
      if (versionBadge) versionBadge.textContent = VERSION;

      const tabContent = {
        code: `
<h3>ğŸ“ Documentation du Code</h3>
<p class="doc-intro">API et signatures des principales fonctions du jeu.</p>
<div class="doc-section">
  <h4>âš™ï¸ Configuration</h4>
  <div class="doc-item"><code>STORAGE_KEY: string</code><p>ClÃ© localStorage pour la sauvegarde (<code>"neo-survivors-save"</code>)</p></div>
  <div class="doc-item"><code>VERSION: string</code><p>Version actuelle du jeu (<code>${VERSION}</code>)</p></div>
  <div class="doc-item"><code>MAX_OFFLINE_SECONDS: number</code><p>DurÃ©e max des gains hors-ligne (3 heures)</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ® SystÃ¨mes de Jeu</h4>
  <div class="doc-item"><code>updateCombat(state: GameState, dt: number, canvas: HTMLCanvasElement): void</code><p>Met Ã  jour la logique de combat : collisions, dÃ©gÃ¢ts, mort des ennemis.</p></div>
  <div class="doc-item"><code>updateSpawn(state: GameState, dt: number, canvas: HTMLCanvasElement): void</code><p>GÃ¨re le spawn des ennemis selon la vague courante.</p></div>
  <div class="doc-item"><code>updateHud(state: GameState, context: HudContext): void</code><p>Actualise l'affichage HUD (ressources, stats, boutons).</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ’¾ Persistance</h4>
  <div class="doc-item"><code>loadSave(): void</code><p>Charge la sauvegarde depuis localStorage.</p></div>
  <div class="doc-item"><code>saveGame(): void</code><p>Sauvegarde l'Ã©tat du jeu dans localStorage.</p></div>
  <div class="doc-item"><code>grantOfflineGains(seconds: number): void</code><p>Applique les gains passifs accumulÃ©s hors-ligne.</p></div>
</div>
<div class="doc-section">
  <h4>âš¡ Progression</h4>
  <div class="doc-item"><code>computeIdleRate(): number</code><p>Calcule le taux de production passive total (âš¡/s).</p></div>
  <div class="doc-item"><code>computeTalentBonuses(talents: Talent[]): TalentBonuses</code><p>Calcule les bonus cumulÃ©s des talents dÃ©bloquÃ©s.</p></div>
  <div class="doc-item"><code>prestige(): void</code><p>Lance une Consolidation et augmente le multiplicateur passif.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ¨ Rendu</h4>
  <div class="doc-item"><code>WebGL2Renderer.create(canvas: HTMLCanvasElement): WebGL2Renderer</code><p>CrÃ©e une instance du renderer WebGL2 optimisÃ©.</p></div>
  <div class="doc-item"><code>addFloatingText(state, text, x, y, color?): void</code><p>Ajoute un texte flottant animÃ© (dÃ©gÃ¢ts, gains).</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ”Š Audio</h4>
  <div class="doc-item"><code>initSound(enabled: boolean): void</code><p>Initialise le systÃ¨me audio procÃ©dural.</p></div>
  <div class="doc-item"><code>playPurchase(): void</code><p>Joue le son d'achat.</p></div>
</div>`,

        wiki: `
<h3>ğŸ“– Wiki du Jeu</h3>
<p class="doc-intro">Documentation complÃ¨te de Neo Survivors Idle.</p>
<div class="doc-section">
  <h4>ğŸš€ DÃ©marrage</h4>
  <div class="wiki-item"><strong>DÃ©marrage Rapide</strong><p>Ouvrez <code>index.html</code> ou lancez un serveur local avec <code>python -m http.server 8000</code>.</p></div>
  <div class="wiki-item"><strong>Premiers Pas</strong><p>Le personnage se dÃ©place et tire automatiquement. Achetez des gÃ©nÃ©rateurs avec l'Essence âš¡ et des upgrades avec les Fragments âœ¦.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ¯ MÃ©caniques de Jeu</h4>
  <div class="wiki-item"><strong>Combat Automatique</strong><p>Projectiles rotatifs autour du joueur, dÃ©gÃ¢ts critiques, perforation. Le joueur se dÃ©place vers les fragments Ã  collecter.</p></div>
  <div class="wiki-item"><strong>Vagues Infinies</strong><p>Les ennemis spawn depuis les bords. FrÃ©quence et HP augmentent avec la vague. Les Ã©lites donnent Ã—3 rÃ©compenses.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ’° Ã‰conomie</h4>
  <div class="wiki-item"><strong>âš¡ Essence</strong><p>Produite passivement par les gÃ©nÃ©rateurs. Sert Ã  acheter plus de gÃ©nÃ©rateurs.</p></div>
  <div class="wiki-item"><strong>âœ¦ Fragments</strong><p>DroppÃ©s par les ennemis, aspirÃ©s automatiquement. Servent aux upgrades et talents.</p></div>
</div>
<div class="doc-section">
  <h4>âŸ³ Prestige</h4>
  <div class="wiki-item"><strong>Consolidation</strong><p>Remet la vague Ã  1 mais augmente le multiplicateur passif permanent. Formule : <code>1 + âˆš(vague) Ã— 0.25</code>.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸŒ³ Talents</h4>
  <div class="wiki-item"><strong>Arbre de Talents</strong><p>Synergies persistantes : dÃ©gÃ¢ts, cadence, Ã©conomie, dÃ©fense. Chaque talent a des prÃ©requis et un coÃ»t en Fragments.</p></div>
</div>
<div class="doc-section">
  <h4>â“ FAQ</h4>
  <div class="wiki-item"><strong>Sauvegarde</strong><p>Automatique toutes les 5 secondes dans localStorage. Jusqu'Ã  3h de gains hors-ligne.</p></div>
  <div class="wiki-item"><strong>Performance</strong><p>Mode Perfo rÃ©duit les effets visuels. Cible : 60 FPS, acceptable : 30+ FPS.</p></div>
</div>`,

        changelog: `
<h3>ğŸ“‹ Historique des Versions</h3>
<p class="doc-intro">Toutes les modifications notables du jeu.</p>
<div class="doc-section">
  <h4>ğŸš§ [Unreleased]</h4>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>Dialogue de documentation avec onglets (code, wiki, versions, roadmap).</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ‰ [v0.1.0] - 2025-11-27</h4>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>PremiÃ¨re version jouable de Neo Survivors Idle : auto-battler idle 100% client-side.</p></div>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>Boucle de combat infinie avec dÃ©placement automatique, tirs circulaires, vagues progressives.</p></div>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>Fragments aspirÃ©s par aimant et essence gÃ©nÃ©rÃ©e passivement.</p></div>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>Arbre d'amÃ©liorations et gÃ©nÃ©rateurs configurables.</p></div>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>Mode performance pour limiter les effets visuels.</p></div>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>HUD complet (vague, kills, ressources, badge de version).</p></div>
  <div class="changelog-item"><span class="badge badge-add">Ajout</span><p>Prestige de consolidation et outils de debug intÃ©grÃ©s.</p></div>
</div>`,

        roadmap: `
<h3>ğŸ—ºï¸ Roadmap</h3>
<p class="doc-intro">FonctionnalitÃ©s prÃ©vues pour les prochaines versions.</p>
<div class="doc-section">
  <h4>ğŸ“… v0.2.0 - AmÃ©lioration de l'ExpÃ©rience</h4>
  <div class="roadmap-item"><span class="status status-planned">PlanifiÃ©</span><strong>Nouveaux types d'ennemis</strong><p>Boss de fin de vague, ennemis Ã  patterns spÃ©ciaux.</p></div>
  <div class="roadmap-item"><span class="status status-planned">PlanifiÃ©</span><strong>SystÃ¨me d'achievements</strong><p>Badges et rÃ©compenses pour les jalons atteints.</p></div>
  <div class="roadmap-item"><span class="status status-planned">PlanifiÃ©</span><strong>Export/Import de sauvegarde</strong><p>PossibilitÃ© de transfÃ©rer sa progression entre appareils.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ“… v0.3.0 - Contenu Additionnel</h4>
  <div class="roadmap-item"><span class="status status-idea">IdÃ©e</span><strong>Nouveaux talents</strong><p>Extension de l'arbre de talents avec de nouvelles synergies.</p></div>
  <div class="roadmap-item"><span class="status status-idea">IdÃ©e</span><strong>Skins de personnage</strong><p>Personnalisation visuelle du hÃ©ros.</p></div>
  <div class="roadmap-item"><span class="status status-idea">IdÃ©e</span><strong>Modes de jeu alternatifs</strong><p>Mode speedrun, mode survie chronomÃ©trÃ©.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ”® Ã€ Long Terme</h4>
  <div class="roadmap-item"><span class="status status-idea">IdÃ©e</span><strong>Multijoueur asynchrone</strong><p>Classements et dÃ©fis communautaires.</p></div>
  <div class="roadmap-item"><span class="status status-idea">IdÃ©e</span><strong>Application mobile</strong><p>Version PWA installable sur mobile.</p></div>
</div>
<div class="doc-section">
  <h4>ğŸ’¡ SuggÃ©rer une FonctionnalitÃ©</h4>
  <p>Ouvrez une issue sur le <a href="https://github.com/npiron/SolarSystem/issues" target="_blank" rel="noopener">dÃ©pÃ´t GitHub</a> pour proposer vos idÃ©es !</p>
</div>`
      };

      function switchTab(tabId) {
        tabs.querySelectorAll('.doc-tab').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabId);
        });
        if (tabContent[tabId]) {
          content.innerHTML = tabContent[tabId];
        }
      }

      // Initialize with code tab
      switchTab('code');

      // Tab click handler
      tabs.addEventListener('click', (e) => {
        const btn = e.target.closest('.doc-tab');
        if (btn && btn.dataset.tab) {
          switchTab(btn.dataset.tab);
        }
      });

      // Open dialog button
      docBtn.addEventListener('click', () => dialog.showModal());

      // Close on backdrop click
      dialog.addEventListener('click', (e) => {
        if (e.target === dialog) dialog.close();
      });

      // Close on Escape
      dialog.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') dialog.close();
      });
    })();
  </script>

  <script type="module" src="./src/main.js"></script>
</body>
</html>
